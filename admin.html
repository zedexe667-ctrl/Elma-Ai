<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† Elma ğŸ‘‘</title>
  <script src="https://kit.fontawesome.com/a2e0e6ad49.js" crossorigin="anonymous"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center">

  <!-- ğŸ” ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† -->
  <div id="loginSection"
    class="glass-effect bg-gray-800 bg-opacity-70 p-8 rounded-3xl shadow-2xl w-full max-w-md text-center">
    <h1 class="text-2xl font-bold mb-6 gradient-text">ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† Elma ğŸ‘‘</h1>

    <input id="adminEmail" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø¯Ù…ÛŒÙ†"
      class="w-full p-3 mb-4 rounded-xl border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-400">

    <input id="adminPassword" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
      class="w-full p-3 mb-4 rounded-xl border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-400">

    <button id="loginBtn"
      class="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl hover:scale-105 transition-all font-semibold">
      ÙˆØ±ÙˆØ¯
    </button>

    <p id="loginMsg" class="mt-4 text-sm text-red-400 hidden"></p>
  </div>

  <!-- ğŸ‘‘ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª -->
  <div id="adminPanel"
    class="hidden glass-effect bg-gray-800 bg-opacity-70 p-8 rounded-3xl shadow-2xl w-full max-w-md text-center">
    <h1 class="text-2xl font-bold mb-6 gradient-text">ğŸ¯ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Elma</h1>

    <div class="space-y-4 text-right">
      <label class="block text-sm">Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±:</label>
      <input id="userEmail" type="email"
        class="w-full p-3 rounded-xl border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-400"
        placeholder="example@email.com">

      <label class="block text-sm mt-4">Ù†ÙˆØ¹ Ø­Ø³Ø§Ø¨:</label>
      <select id="newType"
        class="w-full p-3 rounded-xl border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-400">
        <option value="free">Ø±Ø§ÛŒÚ¯Ø§Ù† ğŸ’•</option>
        <option value="premium">Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ… ğŸ‘‘</option>
      </select>

      <label class="block text-sm mt-4">Ù…Ø¯Øª Ø§Ø´ØªØ±Ø§Ú©:</label>
      <select id="planMonths"
        class="w-full p-3 rounded-xl border border-gray-600 bg-gray-700 focus:outline-none focus:ring-2 focus:ring-pink-400">
        <option value="0">Ø¨Ø¯ÙˆÙ† ØªÙ…Ø¯ÛŒØ¯</option>
        <option value="3">Û³ Ù…Ø§Ù‡</option>
        <option value="6">Û¶ Ù…Ø§Ù‡</option>
        <option value="12">Û±Û² Ù…Ø§Ù‡</option>
      </select>

      <button id="updateUser"
        class="w-full mt-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl hover:scale-105 transition-all font-semibold">
        <i class="fas fa-sync-alt mr-2"></i> Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø³Ø§Ø¨
      </button>

      <p id="updateMsg" class="mt-4 text-sm text-green-400 hidden"></p>
    </div>

    <button id="logoutBtn" class="mt-8 text-sm text-gray-300 hover:text-red-400 transition-all duration-200">
      Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨
    </button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDocs, query, where, updateDoc, collection } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ğŸ”¥ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†)
    const firebaseConfig = {
      apiKey: "AIzaSyD_Ar1zFTBS9DDFlAflPt2IpcQ5y8EI5pE",
      authDomain: "zed-exe-48839.firebaseapp.com",
      projectId: "zed-exe-48839",
      storageBucket: "zed-exe-48839.firebasestorage.app",
      messagingSenderId: "283941493182",
      appId: "1:283941493182:web:7a9deae50c01c9feb8c1ef",
      measurementId: "G-014WZDJBSL"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ğŸ“Œ ÙÙ‚Ø· Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
    const adminEmails = ["elma.ai@gmail.com"];

    const loginSection = document.getElementById("loginSection");
    const adminPanel = document.getElementById("adminPanel");
    const loginBtn = document.getElementById("loginBtn");
    const loginMsg = document.getElementById("loginMsg");

    const userEmail = document.getElementById("userEmail");
    const newType = document.getElementById("newType");
    const planMonths = document.getElementById("planMonths");
    const updateUser = document.getElementById("updateUser");
    const updateMsg = document.getElementById("updateMsg");
    const logoutBtn = document.getElementById("logoutBtn");

    // ğŸ” ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†
    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("adminEmail").value.trim();
      const password = document.getElementById("adminPassword").value.trim();

      if (!email || !password) {
        showMsg("Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯", true);
        return;
      }

      try {
        const res = await signInWithEmailAndPassword(auth, email, password);
        if (adminEmails.includes(res.user.email)) {
          loginSection.classList.add("hidden");
          adminPanel.classList.remove("hidden");
        } else {
          showMsg("â›”ï¸ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ† Ù†ÛŒØ³Øª!", true);
          await signOut(auth);
        }
      } catch (err) {
        showMsg("âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: " + err.message, true);
      }
    });

    // ğŸšª Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      adminPanel.classList.add("hidden");
      loginSection.classList.remove("hidden");
    });

    // ğŸ‘ï¸ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯
    onAuthStateChanged(auth, (user) => {
      if (user && adminEmails.includes(user.email)) {
        loginSection.classList.add("hidden");
        adminPanel.classList.remove("hidden");
      } else {
        adminPanel.classList.add("hidden");
        loginSection.classList.remove("hidden");
      }
    });

    // âš™ï¸ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±
    updateUser.addEventListener("click", async () => {
      updateMsg.classList.add("hidden");
      const email = userEmail.value.trim();
      const type = newType.value;
      const months = parseInt(planMonths.value);

      if (!email) {
        showMsg("Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯", true);
        return;
      }

      try {
        const q = query(collection(db, "users"), where("email", "==", email));
        const snap = await getDocs(q);

        if (snap.empty) {
          showMsg("â—ï¸Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯", true);
          return;
        }

        for (const docSnap of snap.docs) {
          const userRef = doc(db, "users", docSnap.id);
          const data = docSnap.data();

          const now = new Date();
          let newExpiry = new Date();
          const currentExpiry = data.premiumExpiry ? new Date(data.premiumExpiry) : null;

          if (type === "premium" && months > 0) {
            if (currentExpiry && currentExpiry > now) {
              newExpiry = new Date(currentExpiry);
              newExpiry.setMonth(newExpiry.getMonth() + months);
            } else {
              newExpiry.setMonth(now.getMonth() + months);
            }

            await updateDoc(userRef, {
              accountType: "premium",
              purchasedPlus: true,
              premiumExpiry: newExpiry.toISOString()
            });

            showMsg(`âœ… Ø­Ø³Ø§Ø¨ ${email} ØªØ§ ${newExpiry.toLocaleDateString("fa-IR")} ØªÙ…Ø¯ÛŒØ¯ Ø´Ø¯`);
          } else {
            await updateDoc(userRef, { accountType: type });
            showMsg(`âœ… Ø­Ø³Ø§Ø¨ ${email} Ø¨Ù‡ "${type}" ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`);
          }
        }
      } catch (err) {
        showMsg("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø³Ø§Ø¨: " + err.message, true);
      }
    });

    // ğŸ“© Ù¾ÛŒØ§Ù…
    function showMsg(msg, isError = false) {
      loginMsg.textContent = msg;
      loginMsg.classList.remove("hidden");
      loginMsg.classList.toggle("text-red-400", isError);
      loginMsg.classList.toggle("text-green-400", !isError);
      updateMsg.textContent = msg;
      updateMsg.classList.remove("hidden");
      updateMsg.classList.toggle("text-red-400", isError);
      updateMsg.classList.toggle("text-green-400", !isError);
    }
  </script>

  <style>
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
    }

    .gradient-text {
      background: linear-gradient(to right, #f472b6, #8b5cf6);
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
    }
  </style>

</body>

</html>
