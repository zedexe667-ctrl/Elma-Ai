<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†</title>
  <link rel="icon" type="image/png" href="Assets/img/logo/Logo.png" />

  <!-- Tailwind (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§ÛŒÙ„ Ø³Ø±ÛŒØ¹) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-b from-indigo-500 to-purple-600 min-h-screen flex items-center justify-center p-4">

  <div class="bg-white w-full max-w-sm rounded-2xl shadow-xl p-6 space-y-6">
    <!-- ğŸ”‘ ÙØ±Ù… ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† -->
    <div id="loginSection">
      <h1 class="text-2xl font-bold text-center text-gray-800 mb-4">ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</h1>
      <input id="adminEmail" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø¯Ù…ÛŒÙ†"
        class="w-full mb-3 p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400">
      <input id="adminPass" type="password" placeholder="Ù¾Ø³ÙˆØ±Ø¯"
        class="w-full mb-4 p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400">
      <button id="adminLogin"
        class="w-full py-3 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition">ÙˆØ±ÙˆØ¯</button>
      <p id="loginMsg" class="text-center text-red-500 mt-2 hidden"></p>
    </div>

    <!-- ğŸ‘‘ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† -->
    <div id="adminPanel" class="hidden space-y-4">
      <h2 class="text-xl font-bold text-gray-700 text-center">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±</h2>
      <input id="userEmail" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±"
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-400">
      <select id="newType"
        class="w-full p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-400">
        <option value="free">Ø­Ø³Ø§Ø¨ Ø±Ø§ÛŒÚ¯Ø§Ù†</option>
        <option value="premium">Ø­Ø³Ø§Ø¨ Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…</option>
      </select>
      <button id="updateUser"
        class="w-full py-3 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø³Ø§Ø¨</button>
      <p id="updateMsg" class="text-center mt-2 hidden"></p>
    </div>
  </div>

  <!-- ğŸ”¥ Firebase (ES Modules) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
    import {
      getFirestore, doc, updateDoc, collection,
      query, where, getDocs
    } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

    // âœ… Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD_Ar1zFTBS9DDFlAflPt2IpcQ5y8EI5pE",
      authDomain: "zed-exe-48839.firebaseapp.com",
      projectId: "zed-exe-48839",
      storageBucket: "zed-exe-48839.appspot.com",   // ğŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯
      messagingSenderId: "283941493182",
      appId: "1:283941493182:web:7a9deae50c01c9feb8c1ef",
      measurementId: "G-014WZDJBSL"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // âœ… ÙÙ‚Ø· Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø±Ù†Ø¯
    const adminList = ["elma.ai@gmail.com"];

    const loginSection = document.getElementById('loginSection');
    const adminPanel   = document.getElementById('adminPanel');
    const loginMsg     = document.getElementById('loginMsg');
    const updateMsg    = document.getElementById('updateMsg');

    // ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†
    document.getElementById('adminLogin').addEventListener('click', async () => {
      loginMsg.classList.add('hidden');
      const email = adminEmail.value.trim();
      const pass  = adminPass.value.trim();
      if (!email || !pass) {
        loginMsg.textContent = "Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ù¾Ø³ÙˆØ±Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
        loginMsg.classList.remove('hidden');
        return;
      }
      try {
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        if (adminList.includes(email)) {
          loginSection.classList.add('hidden');
          adminPanel.classList.remove('hidden');
        } else {
          loginMsg.textContent = "â›”ï¸ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø¯Ù…ÛŒÙ† Ù†ÛŒØ³Øª";
          loginMsg.classList.remove('hidden');
          await signOut(auth);
        }
      } catch (err) {
        loginMsg.textContent = "Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: " + err.message;
        loginMsg.classList.remove('hidden');
      }
    });

    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±
    document.getElementById('updateUser').addEventListener('click', async () => {
      updateMsg.classList.add('hidden');
      const targetEmail = userEmail.value.trim();
      const type = newType.value;
      if (!targetEmail) {
        updateMsg.textContent = "Ø§ÛŒÙ…ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯";
        updateMsg.classList.remove('hidden');
        return;
      }
      try {
        const q = query(collection(db, "users"), where("email", "==", targetEmail));
        const snap = await getDocs(q);

        if (snap.empty) {
          updateMsg.textContent = "â—ï¸Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯";
          updateMsg.classList.remove('hidden');
          return;
        }

        // Ø¢Ù¾Ø¯ÛŒØª Ù‡Ù…Ù‡â€ŒÛŒ Ø¯Ø§Ú©ÛŒÙˆÙ…Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡
        for (const d of snap.docs) {
          await updateDoc(doc(db, "users", d.id), { accountType: type });
        }

        updateMsg.textContent = "âœ… Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Â«" + type + "Â» ØªØºÛŒÛŒØ± Ú©Ø±Ø¯";
        updateMsg.classList.remove('hidden');
      } catch (err) {
        updateMsg.textContent = "Ø®Ø·Ø§: " + err.message;
        updateMsg.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>

